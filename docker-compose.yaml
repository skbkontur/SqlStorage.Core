version: "2.4"
services:
    postgres:
        container_name: postgres
        image: postgres:11.4
        platform: linux
        restart: always
        environment:
            POSTGRES_USER: postgres
            POSTGRES_PASSWORD: postgres
            POSTGRES_INITDB_WALDIR: /pg_waldir
            PGDATA: /pg_data
        ports:
            - 5432:5432
        healthcheck:
            test: ["CMD-SHELL", "pg_isready -U postgres"]
            interval: 10s
            timeout: 5s
            retries: 5
            
    healthcheck_halt:
        container_name: healthcheck_halt
        image: busybox:latest
        platform: linux
        depends_on:
            postgres:
                condition: service_healthy